{"ast":null,"code":"import _regeneratorRuntime from \"/Users/albert/projects/med-bakery-react/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/albert/projects/med-bakery-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/albert/projects/med-bakery-react/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/albert/projects/med-bakery-react/client/src/components/OSCEPage/OSCEPage.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from \"react\";\nimport { Switch, Route } from \"react-router-dom\";\nimport OSCESelector from \"./OSCESelector\";\nimport StationPage from \"./StationPage\";\nimport MetaContext from \"../../MetaContext\";\nimport { NullStation } from \"./DemoStations/NullStation\";\nimport axios from \"../../myaxios\";\nimport { binaryToCode, downloadAssets, extractReponseAudio, populateMarkScheme, populateResponseAudios, useUserDetails } from \"./hooks\";\nimport LoadingOverlay from \"./LoadingOverlay\";\nimport Navigator from \"../Navigator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar OSCEPage = function OSCEPage() {\n  _s();\n\n  var _useContext = useContext(MetaContext),\n      token = _useContext.token,\n      SERVER_URL = _useContext.SERVER_URL;\n\n  var _useState = useState(NullStation),\n      _useState2 = _slicedToArray(_useState, 2),\n      station = _useState2[0],\n      updateStation = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      stationSummarires = _useState4[0],\n      updateStationSummaries = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      reviewMode = _useState6[0],\n      updateReviewMode = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading = _useState8[0],\n      updateLoading = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      stationeSummariesLoading = _useState10[0],\n      updateSummariesLoading = _useState10[1];\n\n  var _useUserDetails = useUserDetails(SERVER_URL, token),\n      _useUserDetails2 = _slicedToArray(_useUserDetails, 2),\n      userDetailsOsce = _useUserDetails2[0],\n      userLoading = _useUserDetails2[1];\n\n  var loadSummaries = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              updateSummariesLoading(true);\n              _context.prev = 1;\n              _context.next = 4;\n              return axios.post(SERVER_URL + \"/osce/get_stations\", {\n                token: token\n              });\n\n            case 4:\n              res = _context.sent;\n\n              if (res.data.success) {\n                _context.next = 7;\n                break;\n              }\n\n              throw \"loadSummaries (OSCEPage.tsx): station summary retrieval failed\";\n\n            case 7:\n              updateStationSummaries(res.data.summaries);\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](1);\n              console.error(_context.t0);\n\n            case 13:\n              updateSummariesLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 10]]);\n    }));\n\n    return function loadSummaries() {\n      return _ref.apply(this, arguments);\n    };\n  }(); // cant have asynchronous effect callback\n\n\n  useEffect(function () {\n    loadSummaries();\n  }, []);\n\n  var selectStation = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id, options) {\n      var axres, matches, rawResponseAudios, stationWithMarks, stationWithResponses, localContentStation, _localContentStation;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              updateLoading(true);\n              updateReviewMode(options.review);\n              _context2.prev = 2;\n              _context2.next = 5;\n              return axios.post(SERVER_URL + \"/osce/get_station\", {\n                token: token,\n                id: id\n              });\n\n            case 5:\n              axres = _context2.sent;\n\n              if (axres.data.success) {\n                _context2.next = 8;\n                break;\n              }\n\n              throw \"selecteStation (OSCEPage): Station retrieval failed!\";\n\n            case 8:\n              if (!options.review) {\n                _context2.next = 19;\n                break;\n              }\n\n              matches = userDetailsOsce.answeredStations.filter(function (s) {\n                return s.id === axres.data.station.id;\n              });\n              rawResponseAudios = matches.length === 0 ? Array(axres.data.station.questions.length).fill(\"\") : matches[0].responseAudios;\n              stationWithMarks = populateMarkScheme(axres.data.station, options.marks);\n              stationWithResponses = populateResponseAudios(stationWithMarks, rawResponseAudios);\n              _context2.next = 15;\n              return downloadAssets(stationWithResponses, SERVER_URL);\n\n            case 15:\n              localContentStation = _context2.sent;\n              updateStation(localContentStation);\n              _context2.next = 23;\n              break;\n\n            case 19:\n              _context2.next = 21;\n              return downloadAssets(axres.data.station, SERVER_URL);\n\n            case 21:\n              _localContentStation = _context2.sent;\n              updateStation(_localContentStation);\n\n            case 23:\n              _context2.next = 28;\n              break;\n\n            case 25:\n              _context2.prev = 25;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.error(_context2.t0);\n\n            case 28:\n              updateLoading(false);\n\n            case 29:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 25]]);\n    }));\n\n    return function selectStation(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleExit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(questions, tok) {\n      var points, markCode, responseAudios;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              updateLoading(true);\n              points = questions.map(function (q) {\n                return q.markScheme.map(function (ms) {\n                  return ms.points.map(function (p) {\n                    return p.selected ? 1 : 0;\n                  });\n                });\n              }).flat(2);\n              markCode = binaryToCode([1].concat(points));\n\n              if (reviewMode) {\n                _context3.next = 9;\n                break;\n              }\n\n              _context3.next = 6;\n              return extractReponseAudio(questions);\n\n            case 6:\n              responseAudios = _context3.sent;\n              _context3.next = 9;\n              return axios.post(SERVER_URL + \"/osce/update_stations\", {\n                token: tok,\n                markCode: markCode,\n                id: station.id,\n                responseAudios: responseAudios\n              });\n\n            case 9:\n              updateStation(NullStation);\n              window.location.href = \"/OSCE\";\n              updateLoading(false);\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleExit(_x3, _x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Navigator, {\n      selection: \"OSCE\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(Switch, {\n      children: [loading && /*#__PURE__*/_jsxDEV(LoadingOverlay, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 29\n      }, _this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/OSCE\",\n        children: /*#__PURE__*/_jsxDEV(OSCESelector, {\n          stationSummarires: stationSummarires,\n          answeredStations: userDetailsOsce.answeredStations,\n          selectStation: selectStation,\n          station: station,\n          purchasedOsce: userDetailsOsce.purchasedOsce,\n          stationSummariesLoading: stationeSummariesLoading || userLoading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 17\n      }, _this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/OSCE/Station\",\n        children: /*#__PURE__*/_jsxDEV(StationPage, {\n          handleExit: handleExit,\n          station: station,\n          updateStation: updateStation,\n          answeredStations: userDetailsOsce.answeredStations,\n          reviewMode: reviewMode\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 21\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 17\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(OSCEPage, \"ZXfF6pfFDCrNZHZOz9wBitTjoiQ=\", false, function () {\n  return [useUserDetails];\n});\n\n_c = OSCEPage;\nexport default OSCEPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"OSCEPage\");","map":{"version":3,"sources":["/Users/albert/projects/med-bakery-react/client/src/components/OSCEPage/OSCEPage.tsx"],"names":["useContext","useEffect","useState","Switch","Route","OSCESelector","StationPage","MetaContext","NullStation","axios","binaryToCode","downloadAssets","extractReponseAudio","populateMarkScheme","populateResponseAudios","useUserDetails","LoadingOverlay","Navigator","OSCEPage","token","SERVER_URL","station","updateStation","stationSummarires","updateStationSummaries","reviewMode","updateReviewMode","loading","updateLoading","stationeSummariesLoading","updateSummariesLoading","userDetailsOsce","userLoading","loadSummaries","post","res","data","success","summaries","console","error","selectStation","id","options","review","axres","matches","answeredStations","filter","s","rawResponseAudios","length","Array","questions","fill","responseAudios","stationWithMarks","marks","stationWithResponses","localContentStation","handleExit","tok","points","map","q","markScheme","ms","p","selected","flat","markCode","concat","window","location","href","purchasedOsce"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from \"react\";\nimport { Switch, Route, useLocation } from \"react-router-dom\";\nimport OSCESelector from \"./OSCESelector\";\nimport StationPage from \"./StationPage\";\nimport MetaContext from \"../../MetaContext\";\nimport { NullStation } from \"./DemoStations/NullStation\";\nimport axios from \"../../myaxios\";\nimport { AnsweredStationDetails, Question, StationSummary } from \"./types\";\nimport {\n    binaryToCode,\n    downloadAssets,\n    extractReponseAudio,\n    populateMarkScheme,\n    populateResponseAudios,\n    useUserDetails,\n} from \"./hooks\";\nimport LoadingOverlay from \"./LoadingOverlay\";\nimport Navigator from \"../Navigator\";\n\nconst OSCEPage = () => {\n    const { token, SERVER_URL } = useContext(MetaContext);\n    const [station, updateStation] = useState(NullStation);\n    const [stationSummarires, updateStationSummaries] = useState<StationSummary[]>([]);\n    const [reviewMode, updateReviewMode] = useState(false);\n    const [loading, updateLoading] = useState(false);\n    const [stationeSummariesLoading, updateSummariesLoading] = useState(false);\n    const [userDetailsOsce, userLoading] = useUserDetails(SERVER_URL, token);\n\n    const loadSummaries = async () => {\n        updateSummariesLoading(true);\n\n        try {\n            const res = await axios.post(SERVER_URL + \"/osce/get_stations\", { token });\n\n            if (!res.data.success) {\n                throw \"loadSummaries (OSCEPage.tsx): station summary retrieval failed\";\n            }\n\n            updateStationSummaries(res.data.summaries);\n        } catch (error) {\n            console.error(error);\n        }\n        updateSummariesLoading(false);\n    };\n\n    // cant have asynchronous effect callback\n    useEffect(() => {\n        loadSummaries();\n    }, []);\n\n    const selectStation = async (id: string, options: { review: boolean; marks: (0 | 1)[] }) => {\n        updateLoading(true);\n        updateReviewMode(options.review);\n\n        try {\n            const axres = await axios.post(SERVER_URL + \"/osce/get_station\", { token, id });\n\n            if (!axres.data.success) {\n                throw \"selecteStation (OSCEPage): Station retrieval failed!\";\n            }\n\n            if (options.review) {\n                const matches = userDetailsOsce.answeredStations.filter(\n                    s => s.id === axres.data.station.id\n                );\n                const rawResponseAudios =\n                    matches.length === 0\n                        ? Array(axres.data.station.questions.length).fill(\"\")\n                        : matches[0].responseAudios;\n\n                const stationWithMarks = populateMarkScheme(axres.data.station, options.marks);\n                const stationWithResponses = populateResponseAudios(\n                    stationWithMarks,\n                    rawResponseAudios\n                );\n                const localContentStation = await downloadAssets(stationWithResponses, SERVER_URL);\n                updateStation(localContentStation);\n            } else {\n                const localContentStation = await downloadAssets(axres.data.station, SERVER_URL);\n                updateStation(localContentStation);\n            }\n        } catch (e) {\n            console.error(e);\n        }\n        updateLoading(false);\n    };\n\n    const handleExit = async (questions: Question[], tok: string) => {\n        updateLoading(true);\n\n        const points = questions\n            .map(q => q.markScheme.map(ms => ms.points.map(p => (p.selected ? 1 : 0))))\n            .flat(2);\n        const markCode = binaryToCode([1 as 1 | 0].concat(points));\n\n        if (!reviewMode) {\n            const responseAudios = await extractReponseAudio(questions);\n            await axios.post(SERVER_URL + \"/osce/update_stations\", {\n                token: tok,\n                markCode,\n                id: station.id,\n                responseAudios,\n            });\n        }\n\n        updateStation(NullStation);\n        window.location.href = \"/OSCE\";\n\n        updateLoading(false);\n    };\n\n    return (\n        <>\n            <Navigator selection={\"OSCE\"} />\n            <Switch>\n                {loading && <LoadingOverlay />}\n\n                <Route exact path=\"/OSCE\">\n                    <OSCESelector\n                        stationSummarires={stationSummarires}\n                        answeredStations={userDetailsOsce.answeredStations}\n                        selectStation={selectStation}\n                        station={station}\n                        purchasedOsce={userDetailsOsce.purchasedOsce}\n                        stationSummariesLoading={stationeSummariesLoading || userLoading}\n                    />\n                </Route>\n\n                <Route path=\"/OSCE/Station\">\n                    <StationPage\n                        handleExit={handleExit}\n                        station={station}\n                        updateStation={updateStation}\n                        answeredStations={userDetailsOsce.answeredStations}\n                        reviewMode={reviewMode}\n                    />\n                </Route>\n            </Switch>\n        </>\n    );\n};\n\nexport default OSCEPage;\n"]},"metadata":{},"sourceType":"module"}