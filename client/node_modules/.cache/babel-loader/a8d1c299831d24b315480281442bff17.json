{"ast":null,"code":"import _regeneratorRuntime from \"/Users/albert/projects/med-bakery-react/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/albert/projects/med-bakery-react/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { renderMethodNotFoundError, renderMissingResponseError, renderUnexpectedResultError } from './error-renderers';\nexport var createMessageHandler = function createMessageHandler(receiver, workerImplementation) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n      var _ref$data, id, method, params, messageHandler, response, synchronousResponse, result, _synchronousResponse$, transferables, message, _err$status, status;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _ref$data = _ref.data, id = _ref$data.id, method = _ref$data.method, params = _ref$data.params;\n              messageHandler = workerImplementation[method];\n              _context.prev = 2;\n\n              if (!(messageHandler === undefined)) {\n                _context.next = 5;\n                break;\n              }\n\n              throw renderMethodNotFoundError({\n                method: method\n              });\n\n            case 5:\n              response = params === undefined ? messageHandler() : messageHandler(params);\n\n              if (!(response === undefined)) {\n                _context.next = 8;\n                break;\n              }\n\n              throw renderMissingResponseError({\n                method: method\n              });\n\n            case 8:\n              if (!(response instanceof Promise)) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 11;\n              return response;\n\n            case 11:\n              _context.t0 = _context.sent;\n              _context.next = 15;\n              break;\n\n            case 14:\n              _context.t0 = response;\n\n            case 15:\n              synchronousResponse = _context.t0;\n\n              if (!(id === null)) {\n                _context.next = 21;\n                break;\n              }\n\n              if (!(synchronousResponse.result !== undefined)) {\n                _context.next = 19;\n                break;\n              }\n\n              throw renderUnexpectedResultError({\n                method: method\n              });\n\n            case 19:\n              _context.next = 25;\n              break;\n\n            case 21:\n              if (!(synchronousResponse.result === undefined)) {\n                _context.next = 23;\n                break;\n              }\n\n              throw renderUnexpectedResultError({\n                method: method\n              });\n\n            case 23:\n              result = synchronousResponse.result, _synchronousResponse$ = synchronousResponse.transferables, transferables = _synchronousResponse$ === void 0 ? [] : _synchronousResponse$;\n              receiver.postMessage({\n                id: id,\n                result: result\n              }, transferables);\n\n            case 25:\n              _context.next = 31;\n              break;\n\n            case 27:\n              _context.prev = 27;\n              _context.t1 = _context[\"catch\"](2);\n              message = _context.t1.message, _err$status = _context.t1.status, status = _err$status === void 0 ? -32603 : _err$status;\n              receiver.postMessage({\n                error: {\n                  code: status,\n                  message: message\n                },\n                id: id\n              });\n\n            case 31:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 27]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n};","map":{"version":3,"sources":["../../../src/helpers/create-message-handler.ts"],"names":[],"mappings":";;AAGA,SAAS,yBAAT,EAAoC,0BAApC,EAAgE,2BAAhE,QAAmG,mBAAnG;AAEA,OAAO,IAAM,oBAAoB,GAAG,SAAvB,oBAAuB,CAA8B,QAA9B,EAAmD,oBAAnD,EAAqG;AACrI;AAAA,yEAAO;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAS,IAAT,EAAiB,EAAjB,aAAiB,EAAjB,EAAqB,MAArB,aAAqB,MAArB,EAA6B,MAA7B,aAA6B,MAA7B;AACG,cAAA,cADH,GACoB,oBAAoB,CAAC,MAAD,CADxC;AAAA;;AAAA,oBAIK,cAAc,KAAK,SAJxB;AAAA;AAAA;AAAA;;AAAA,oBAKW,yBAAyB,CAAC;AAAE,gBAAA,MAAM,EAAN;AAAF,eAAD,CALpC;;AAAA;AAQO,cAAA,QARP,GASK,MAAM,KAAK,SAAX,GACO,cAA8E,EADrF,GAEO,cAAuG,CAAC,MAAD,CAXnH;;AAAA,oBAaK,QAAQ,KAAK,SAblB;AAAA;AAAA;AAAA;;AAAA,oBAcW,0BAA0B,CAAC;AAAE,gBAAA,MAAM,EAAN;AAAF,eAAD,CAdrC;;AAAA;AAAA,oBAiB6B,QAAQ,YAAY,OAjBjD;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAiBiE,QAjBjE;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,4BAiB4E,QAjB5E;;AAAA;AAiBO,cAAA,mBAjBP;;AAAA,oBAmBK,EAAE,KAAK,IAnBZ;AAAA;AAAA;AAAA;;AAAA,oBAoBS,mBAAmB,CAAC,MAApB,KAA+B,SApBxC;AAAA;AAAA;AAAA;;AAAA,oBAqBe,2BAA2B,CAAC;AAAE,gBAAA,MAAM,EAAN;AAAF,eAAD,CArB1C;;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAwBS,mBAAmB,CAAC,MAApB,KAA+B,SAxBxC;AAAA;AAAA;AAAA;;AAAA,oBAyBe,2BAA2B,CAAC;AAAE,gBAAA,MAAM,EAAN;AAAF,eAAD,CAzB1C;;AAAA;AA4Ba,cAAA,MA5Bb,GA4BkE,mBA5BlE,CA4Ba,MA5Bb,0BA4BkE,mBA5BlE,CA4BqB,aA5BrB,EA4BqB,aA5BrB,sCA4BqC,EA5BrC;AA8BK,cAAA,QAAQ,CAAC,WAAT,CAAqB;AAAE,gBAAA,EAAE,EAAF,EAAF;AAAM,gBAAA,MAAM,EAAN;AAAN,eAArB,EAAqC,aAArC;;AA9BL;AAAA;AAAA;;AAAA;AAAA;AAAA;AAiCS,cAAA,OAjCT,eAiCS,OAjCT,4BAiCkB,MAjClB,EAiCkB,MAjClB,4BAiC2B,CAAC,KAjC5B;AAmCC,cAAA,QAAQ,CAAC,WAAT,CAA0D;AAAE,gBAAA,KAAK,EAAE;AAAE,kBAAA,IAAI,EAAE,MAAR;AAAgB,kBAAA,OAAO,EAAP;AAAhB,iBAAT;AAAoC,gBAAA,EAAE,EAAF;AAApC,eAA1D;;AAnCD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAP;;AAAA;AAAA;AAAA;AAAA;AAsCH,CAvCM","sourceRoot":"","sourcesContent":["import { renderMethodNotFoundError, renderMissingResponseError, renderUnexpectedResultError } from './error-renderers';\nexport const createMessageHandler = (receiver, workerImplementation) => {\n    return async ({ data: { id, method, params } }) => {\n        const messageHandler = workerImplementation[method];\n        try {\n            if (messageHandler === undefined) {\n                throw renderMethodNotFoundError({ method });\n            }\n            const response = params === undefined\n                ? messageHandler()\n                : messageHandler(params);\n            if (response === undefined) {\n                throw renderMissingResponseError({ method });\n            }\n            const synchronousResponse = response instanceof Promise ? await response : response;\n            if (id === null) {\n                if (synchronousResponse.result !== undefined) {\n                    throw renderUnexpectedResultError({ method });\n                }\n            }\n            else {\n                if (synchronousResponse.result === undefined) {\n                    throw renderUnexpectedResultError({ method });\n                }\n                const { result, transferables = [] } = synchronousResponse;\n                receiver.postMessage({ id, result }, transferables);\n            }\n        }\n        catch (err) {\n            const { message, status = -32603 } = err;\n            receiver.postMessage({ error: { code: status, message }, id });\n        }\n    };\n};\n//# sourceMappingURL=create-message-handler.js.map"]},"metadata":{},"sourceType":"module"}